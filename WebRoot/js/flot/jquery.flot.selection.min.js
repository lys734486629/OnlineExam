(function(k){k.plot.plugins.push({init:function(a){var n,o,p,f,g,j;function r(b){p&&(s(b),a.getPlaceholder().trigger("plotselecting",[q()]))}function t(b){1==b.which&&(document.body.focus(),void 0!==document.onselectstart&&null==n&&(n=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==o&&(o=document.ondrag,document.ondrag=function(){return false}),u(f,b),p=!0,l=function(b){l=null;if(document.onselectstart!==void 0)document.onselectstart=n;if(document.ondrag!==
void 0)document.ondrag=o;p=false;s(b);if(m())v();else{a.getPlaceholder().trigger("plotunselected",[]);a.getPlaceholder().trigger("plotselecting",[null])}},k(document).one("mouseup",l))}function q(){if(!m())return null;var b={},i=f,c=g;k.each(a.getAxes(),function(a,e){if(e.used){var h=e.c2p(i[e.direction]),f=e.c2p(c[e.direction]);b[a]={from:Math.min(h,f),to:Math.max(h,f)}}});return b}function v(){var b=q();a.getPlaceholder().trigger("plotselected",[b]);b.xaxis&&b.yaxis&&a.getPlaceholder().trigger("selected",
[{x1:b.xaxis.from,y1:b.yaxis.from,x2:b.xaxis.to,y2:b.yaxis.to}])}function u(b,i){var c=a.getOptions(),d=a.getPlaceholder().offset(),e=a.getPlotOffset(),h=i.pageX-d.left-e.left,g=a.width();b.x=0>h?0:h>g?g:h;d=i.pageY-d.top-e.top;e=a.height();b.y=0>d?0:d>e?e:d;"y"==c.selection.mode&&(b.x=b==f?0:a.width());"x"==c.selection.mode&&(b.y=b==f?0:a.height())}function s(b){null!=b.pageX&&(u(g,b),m()?(j=!0,a.triggerRedrawOverlay()):w(!0))}function w(b){j&&(j=!1,a.triggerRedrawOverlay(),b||a.getPlaceholder().trigger("plotunselected",
[]))}function x(b,i){var c,d,e,h,f=a.getAxes(),g;for(g in f)if(c=f[g],c.direction==i&&(h=i+c.n+"axis",!b[h]&&1==c.n&&(h=i+"axis"),b[h])){d=b[h].from;e=b[h].to;break}b[h]||(c="x"==i?a.getXAxes()[0]:a.getYAxes()[0],d=b[i+"1"],e=b[i+"2"]);null!=d&&(null!=e&&d>e)&&(h=d,d=e,e=h);return{from:d,to:e,axis:c}}function m(){return 5<=Math.abs(g.x-f.x)&&5<=Math.abs(g.y-f.y)}f={x:-1,y:-1};g={x:-1,y:-1};p=j=!1;o=n=void 0;var l=null;a.clearSelection=w;a.setSelection=function(b,i){var c,d=a.getOptions();"y"==d.selection.mode?
(f.x=0,g.x=a.width()):(c=x(b,"x"),f.x=c.axis.p2c(c.from),g.x=c.axis.p2c(c.to));"x"==d.selection.mode?(f.y=0,g.y=a.height()):(c=x(b,"y"),f.y=c.axis.p2c(c.from),g.y=c.axis.p2c(c.to));j=!0;a.triggerRedrawOverlay();!i&&m()&&v()};a.getSelection=q;a.hooks.bindEvents.push(function(b,a){null!=b.getOptions().selection.mode&&(a.mousemove(r),a.mousedown(t))});a.hooks.drawOverlay.push(function(b,a){if(j&&m()){var c=b.getPlotOffset(),d=b.getOptions();a.save();a.translate(c.left,c.top);c=k.color.parse(d.selection.color);
a.strokeStyle=c.scale("a",0.8).toString();a.lineWidth=1;a.lineJoin="round";a.fillStyle=c.scale("a",0.4).toString();var c=Math.min(f.x,g.x),d=Math.min(f.y,g.y),e=Math.abs(g.x-f.x),h=Math.abs(g.y-f.y);a.fillRect(c,d,e,h);a.strokeRect(c,d,e,h);a.restore()}});a.hooks.shutdown.push(function(b,a){a.unbind("mousemove",r);a.unbind("mousedown",t);l&&k(document).unbind("mouseup",l)})},options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.1"})})(jQuery);
